
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Enjoy in-app debugging with flutter_ume</title>
  <link rel="preconnect" href="https://fonts.googleapis.cn">
  <link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin>
  <link href="https://fonts.googleapis.cn/css2?family=Noto+Sans+SC:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.cn/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="https://fonts.googleapis.cn/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://static.codelabs.cn/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid="G-W3ZK7MJGEC"
                  id="flutter-ume"
                  title="Enjoy in-app debugging with flutter_ume"
                  environment="web"
                  feedback-link="https://github.com/cfug/ume-codelab/issues">
    
      <google-codelab-step label="介绍" duration="20">
        <p class="image-container"><img style="width: 601.70px" src="img/d4d89cfc3295167e.png"></p>
<h2 is-upgraded><strong>为什么要创建 flutter_ume？</strong></h2>
<p>flutter_ume 是一款针对 Flutter 应用开发的应用内调试工具平台。最初是 2020 年 6 月，由字节跳动西瓜视频 Flutter 基础技术团队孵化，经过内部大量 Flutter 开发者的使用及共建，2021 年 7 月开源 <a href="https://pub.flutter-io.cn/packages/flutter_ume" target="_blank">flutter_ume</a> 社区版本。</p>
<p class="image-container"><img style="width: 601.70px" src="img/ec27127ed67e2e53.png"></p>
<h3 is-upgraded><strong>应用内调试</strong></h3>
<p>一直以来，Flutter 开发者习惯于在计算机上使用 Flutter DevTools 对 Flutter 应用进行调试。这样做存在一定不便，一旦脱离了计算机，如交付给测试人员/产品经理/设计师的测试版本，开发者想要获取应用运行信息将无从下手。</p>
<p>flutter_ume 及相关调试插件作为 Dart Package 接入到宿主应用中，直接将应用的有用数据暴露给开发人员，甚至可以动态调整应用的运行状态。由此，无需依赖计算机，无需 attach 调试器，一次接入后续可直接使用，直接在应用内完成对程序的诊断。</p>
<h3 is-upgraded><strong>插件扩展能力</strong></h3>
<p>flutter_ume 代码包本身是一个调试工具平台，不具备调试能力，但社区版提供了十余个功能各异的调试插件；社区中也有一些开发者贡献了一些优质插件。假如这些插件仍然无法满足你的定制化需求，你也可以通过依赖 flutter_ume 提供的基础能力，来创建定制能力的插件。</p>
<h3 is-upgraded><strong>多平台兼容</strong></h3>
<p>由于 Flutter 是一个跨多平台的自渲染框架，flutter_ume 及其插件也是一个个的 Dart Package，因此 flutter_ume 可以随宿主应用兼容多个平台（因部分功能在各平台上实现有差异，所以无法在所有平台上提供完整的插件功能）。开发者也可根据实际情况，为特定平台开发定制插件。</p>
<h2 is-upgraded><strong>你将构建出什么？</strong></h2>
<p>跟随本 codelab，你将：</p>
<ul>
<li>创建出一个具有简单 UI 的 Flutter App，它包含多个模块的页面</li>
<li>在该应用中接入 flutter_ume，并体验如何在应用内调试应用</li>
<li>切换至 Release 模式构建应用，模拟测试用途的应用，在 Release 模式下体验调试能力</li>
<li>为 flutter_ume 编写一个自定义功能的插件</li>
</ul>
<p>本 codelab 重点关注 flutter_ume 的接入、使用及自定义插件的编写，对于相关性不大的胶水代码，提供了完整的示例，开发者可根据自己的情况拷贝这些代码。</p>


      </google-codelab-step>
    
      <google-codelab-step label="准备工作：配置 Flutter 环境" duration="20">
        <p>如果你之前已经在本地运行过 Flutter 应用，你可以跳过本小节。但请尽量确保本地环境与本文推荐环境版本匹配。</p>
<p class="image-container"><img style="width: 601.70px" src="img/de1175dae2aeeb67.png"></p>
<p>请根据自身需要，配置 Flutter 运行平台对应的开发环境。详尽的环境配置文档请见：<a href="https://flutter.cn/docs/get-started/install" target="_blank">https://flutter.cn/docs/get-started/install</a> 。</p>
<h2 is-upgraded><strong>配置 IDE</strong></h2>
<p>开发 Flutter 应用，官方有两种推荐 IDE：VSCode 与 Android Studio。请根据喜好任选其一。</p>
<ul>
<li>VSCode 下载地址：<a href="https://code.visualstudio.com/" target="_blank">https://code.visualstudio.com/</a></li>
<li>Android Studio 下载地址：<a href="https://developer.android.google.cn/" target="_blank">https://developer.android.google.cn/</a></li>
</ul>
<h3 is-upgraded><strong>VSCode</strong></h3>
<p>在 VSCode 中，左侧边栏选择 Extensions，搜索 &#34;Flutter&#34; 与 &#34;Dart&#34; 并点击 Install 安装。</p>
<p class="image-container"><img style="width: 499.07px" src="img/17c83d57e23280b7.png"></p>
<h3 is-upgraded><strong>Android Studio</strong></h3>
<p>在 Android Studio 中，点击菜单中的 Android Studio-Preferences，点击左侧 Plugins，搜索 Flutter，点击 Install，会询问是否安装依赖 Dart，选择 Yes。</p>
<p class="image-container"><img style="width: 531.50px" src="img/bcb72ee2249f835.png"></p>
<h2 is-upgraded><strong>安装 Flutter SDK</strong></h2>
<p>在不同平台上安装 Flutter SDK 不尽相同，请根据自身情况安装。</p>
<ul>
<li>macOS：<a href="https://flutter.cn/docs/get-started/install/macos" target="_blank">https://flutter.cn/docs/get-started/install/macos</a> </li>
<li>Windows：<a href="https://flutter.cn/docs/get-started/install/windows" target="_blank">https://flutter.cn/docs/get-started/install/windows</a> </li>
<li>Linux：<a href="https://flutter.cn/docs/get-started/install/linux" target="_blank">https://flutter.cn/docs/get-started/install/linux</a> </li>
</ul>
<h2 is-upgraded><strong>配置环境变量</strong></h2>
<aside class="special"><p><strong>提醒:</strong>  针对大陆网络环境，可以先查阅<a href="https://flutter.cn/community/china" target="_blank">该文档</a>，以确定是否需要对网络环境进行设置。</p>
</aside>
<p>在安装完 Flutter SDK 后，请检查你的环境变量中，是否将 Flutter SDK 的路径配置到 PATH 中，且配置了 <code>PUB_HOSTED_URL</code> 以及 <code>FLUTTER_STORAGE_BASE_URL</code>。</p>
<p class="image-container"><img style="width: 601.70px" src="img/a48eec12da2746fa.png"></p>
<p>此时，在完成了上述操作后，在终端输入 <code>flutter doctor</code>，显示无 error，说明你已经完成了 Flutter 开发环境的配置工作了。</p>


      </google-codelab-step>
    
      <google-codelab-step label="编写一个 Flutter App" duration="20">
        <h2 is-upgraded><strong>创建 Flutter 工程</strong></h2>
<p>编写 Flutter App 从创建工程开始。</p>
<p>以下是创建工程的步骤：</p>
<ol type="1" start="1">
<li>打开&#34;终端&#34;</li>
<li>执行 <code>flutter create --platform ios,android,macos demo_app</code></li>
</ol>
<ul>
<li>此处的 <code>--platform</code> 参数是你要创建的 Flutter 应用所运行的平台，每一个平台将会对应创建出该平台的应用 &#34;壳工程&#34;。</li>
<li>demo_app 是你为项目设定的名字，请使用小写字母、数字、下划线的形式命名</li>
</ul>
<p class="image-container"><img style="width: 409.50px" src="img/b25c646f241391ed.png"></p>
<h2 is-upgraded><strong>在模拟器或真实设备上运行应用</strong></h2>
<ol type="1" start="1">
<li>进入项目目录，执行 <code>cd demo_app</code></li>
<li>执行 <code>flutter devices</code> 检查当前运行了哪些设备</li>
</ol>
<ul>
<li>假如没有找到任何设备，请先检查是否连接了真实设备（且开启了开发者模式）或启动了模拟器等</li>
</ul>
<p class="image-container"><img style="width: 411.50px" src="img/ef9a3e617eef4064.png"></p>
<ol type="1" start="3">
<li>执行 <code>flutter run -d xx</code></li>
</ol>
<ul>
<li>&#34;xx&#34; 是上一步获取的设备标识，在这里请替换为该标识。如图中 iOS 模拟器标识为 FD3F5A68-C2A7-4CDC-B942-6BF90B33908B，本机（macOS 电脑）标识为 macos，本地浏览器（web 平台）标识为 chrome。</li>
</ul>
<ol type="1" start="4">
<li>在一段时间的等待后，我们会发现相应的设备启动了 Flutter 应用（左图是 macOS 上运行的 Flutter 应用，右图是在 iOS 模拟器上运行的 Flutter 应用）</li>
</ol>
<p class="image-container"><img style="width: 403.50px" src="img/934a9269f7622133.png"><img style="width: 219.00px" src="img/fd47efd387fb6a41.png"></p>
<aside class="special"><p><strong>提醒：</strong>我们应该能注意到，运行起 Flutter 应用后，在终端上输出了一些内容，大致是说按下某个键可以触发某个开关，在 http://127.0.0.1:xxx/xxx/ 可挂载调试器等。</p>
<p class="image-container"><img style="width: 435.50px" src="img/63526edbdc769b07.png"></p>
<p>这些调试信息主要告知了可以在当前终端使用的调试快捷键，更多更复杂的调试能力，需要使用 Flutter DevTools，并通过挂载至映射到 127.0.0.1 本机的调试服务上实现。</p>
<p>其中 Hot reload 是 Flutter 上大名鼎鼎的 &#34;热重载&#34; 能力，借由此能力，Flutter 具备相当优秀的开发效率。</p>
</aside>
<h2 is-upgraded><strong>使用 IDE 运行工程</strong></h2>
<p>前文讲述的方式，通过在终端通过命令将 Flutter App 运行起来。对于断点调试、更加丰富的交互形式来说，安装了 Flutter 和 Dart 插件的 IDE 是一个更加强大的工具。因此在本小节，我们将使用 IDE 运行 Flutter App。</p>
<h3 is-upgraded><strong>使用 VSCode 运行工程</strong></h3>
<p>在 VSCode 中找到工程目录打开。</p>
<p class="image-container"><img style="width: 601.70px" src="img/e2d88ee0a7967376.png"></p>
<p>点击左侧的 Run &amp; Debug 选项中，并点击 Run and Debug，选择 Dart &amp; Flutter。</p>
<h3 is-upgraded><strong>使用 Android Studio 运行工程</strong></h3>
<p class="image-container"><img style="width: 399.50px" src="img/9caba4947f777acf.png"></p>
<p>打开 Android Studio，选择 Open，找到项目目录。</p>
<aside class="special"><p><strong>提醒：</strong>初次打开项目时，Android Studio 会索引项目需要花费一些时间，在 IDE 底部可以查看进度。在索引完成前，代码高亮、补全、跳转等功能可能不可用。</p>
<p class="image-container"><img style="width: 378.18px" src="img/a898037f01ac8ab4.png"></p>
</aside>
<p class="image-container"><img style="width: 484.50px" src="img/6cb8ba38c9c92dd8.png"></p>
<p>在左侧 Project 窗口中找到 pubspec.yaml，双击打开，在右侧上方 Flutter commands 中选择 Pub get 按钮更新依赖。</p>
<p>完成依赖更新后，在 Android Studio 上方选择要使用的设备，并点击运行按钮。</p>
<p class="image-container"><img style="width: 438.50px" src="img/af5e077ca3ae921c.png"></p>
<h2 is-upgraded><strong>为应用添加自定义功能</strong></h2>
<p>接下来我们为刚刚创建的 demo_app 添加一些代码，后续作为 flutter_ume 的调试示例。你可以自行发挥，代码不必与本小节的内容完全一致。为了加快 Codelab 的速度，你可以直接从这里下载准备好的 Demo 代码示例。</p>
<p>demo_app.1.movie.zip：<a href="https://lf3-static.bytednsdoc.com/obj/eden-cn/clkeh7phrubz/devfest2022/demo_app.1.movie.zip" target="_blank">https://lf3-static.bytednsdoc.com/obj/eden-cn/clkeh7phrubz/devfest2022/demo_app.1.movie.zip</a></p>
<p>在压缩包中有三个文件（夹）：assets 用于存放静态资源文件、lib 用于存放代码文件、pubspec.yaml 描述了工程的信息。</p>
<p>我们将压缩包中的代码与资源对应替换新创建的 Demo 工程中的文件。</p>
<p>运行起我们的 Demo 工程，可以看到设备上展示如下图所示。</p>
<p class="image-container"><img style="width: 194.60px" src="img/c55c51c4d2792491.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="接入 flutter_ume" duration="10">
        <p>上一节运行起 Demo 工程后你可能会发现，在界面上有 &#34;LEFT&#34; 与 &#34;RIGHT&#34; 两个 Page，它们看起来长得完全一样。但在示例代码中会发现，这两个页面并没有复用同一份代码，而是具有两套代码，以及两种 &#34;结构&#34;。</p>
<p>我们尝试将设备旋转 90 度，会发现 &#34;LEFT&#34; 页面将变为双列样式，但 &#34;RIGHT&#34; 页面仍然为单列样式。</p>
<p class="image-container"><img style="width: 405.01px" src="img/d9e2d5377f5630c.png"></p>
<p class="image-container"><img style="width: 409.35px" src="img/cc5dd8a3d29aeb18.png"></p>
<p>下图为 &#34;left_page.dart&#34; 中的 GridView 与 GridCard。</p>
<p class="image-container"><img style="width: 491.51px" src="img/4b75d96e06869fd6.png"></p>
<p>下图为 &#34;right_page.dart&#34; 中的 ListView 与 ListCard。</p>
<p class="image-container"><img style="width: 488.50px" src="img/e7601081a58c3a58.png"></p>
<aside class="warning"><p><strong>思考：</strong>在没有阅读过源代码的情况下，我们有什么方法可以找到 UI 元素上对应的代码呢？</p>
</aside>
<h2 is-upgraded><strong>接入 flutter_ume 框架</strong></h2>
<p><code>pubspec.yaml</code></p>
<pre><code>dev_dependencies:
  flutter_ume: ^1.1.1+1</code></pre>
<p>将正在运行的应用退出。修改 <code>pubspec.yaml</code>，在对应位置添加依赖。</p>
<p>在 Demo 工程目录下执行 <code>flutter pub get</code>。</p>
<p><code>main.dart</code></p>
<pre><code>import &#39;package:flutter_ume/flutter_ume.dart&#39;;

void main() =&gt; runApp(const UMEWidget(child: MyApp()));</code></pre>
<p>在 <code>main.dart</code> 中引入 flutter_ume 依赖，并修改 <code>runApp</code> 方法。</p>
<p>再次运行 Demo 工程，有没有发现此时与刚才有什么不同？</p>
<p class="image-container"><img style="width: 302.64px" src="img/2059c95081cbaee9.png"></p>
<p>我们可以发现在屏幕右下角多了一个圆形 &#34;Flutter Logo&#34; 按钮。这正是 flutter_ume 的入口。</p>
<p>由于我们在 <code>pubspec.yaml</code> 中是以 &#34;<code>dev_dependencies</code>&#34; 的形式引入的 flutter_ume，因此在这里我们同样需要修改一点点代码。</p>
<p><code>main.dart</code></p>
<pre><code>void main() {
  if (kDebugMode) {
    runApp(const UMEWidget(
      child: MyApp(),
    ));
  } else {
    runApp(const MyApp());
  }
}</code></pre>
<p>至此 UME 就成功接入了应用。</p>
<aside class="warning"><p><strong>思考：</strong>kDebugMode 是如何在 Debug mode 与 Release mode 下返回值不同的？</p>
</aside>
<h2 is-upgraded><strong>接入调试插件</strong></h2>
<p>可能你发现了，我们刚刚接入的 flutter_ume &#34;按钮&#34; 点开好像什么都没有。接下来我们将调试插件接入到应用中。同样地，在 <code>pubspec.yaml</code> 中添加插件依赖。</p>
<p><code>pubspec.yaml</code></p>
<pre><code>dev_dependencies:
  flutter_ume_kit_ui: ^1.0.0
  flutter_ume_kit_console: ^1.0.0
  flutter_ume_kit_show_code: ^1.0.0
  flutter_ume_kit_perf: ^1.0.0
  flutter_ume_kit_device: ^1.0.0

dependency_overrides:
  flutter_ume: ^1.1.1+1
  vm_service: ^9.4.0</code></pre>
<p>请注意，由于需要对更广泛的 Flutter 版本支持，需要在 <code>dependency_overrides</code> 中，对 vm_service 的依赖版本 override。</p>
<p>在 main.dart 文件中添加对插件包的引用。</p>
<p><code>main.dart</code></p>
<pre><code>import &#39;package:flutter_ume_kit_ui/flutter_ume_kit_ui.dart&#39;;
import &#39;package:flutter_ume_kit_perf/flutter_ume_kit_perf.dart&#39;;
import &#39;package:flutter_ume_kit_show_code/flutter_ume_kit_show_code.dart&#39;;
import &#39;package:flutter_ume_kit_console/flutter_ume_kit_console.dart&#39;;
import &#39;package:flutter_ume_kit_device/flutter_ume_kit_device.dart&#39;;</code></pre>
<p>在 main 方法中，添加注册插件的方法。</p>
<p><code>main.dart</code></p>
<pre><code>void main() {
  if (kDebugMode) {
    PluginManager.instance
      ..register(WidgetInfoInspector())
      ..register(WidgetDetailInspector())
      ..register(AlignRuler())
      ..register(ColorPicker())
      ..register(TouchIndicator())
      ..register(Performance())
      ..register(ShowCode())
      ..register(MemoryInfoPage())
      ..register(CpuInfoPage())
      ..register(DeviceInfoPanel())
      ..register(Console());
    runApp(const UMEWidget(
      child: MyApp(),
    ));
  } else {
    runApp(const MyApp());
  }
}</code></pre>
<p>退出应用，再次重新执行 <code>flutter pub get</code>，并运行工程。</p>
<p class="image-container"><img style="width: 307.69px" src="img/479179d9d479ed1.png"></p>
<p>点击屏幕上的圆形 Flutter Logo 按钮，可以看到弹出窗口中已经出现了我们注册的调试插件。</p>
<aside class="special"><p><strong>提示：</strong>更多社区贡献的调试插件可访问 https://github.com/cfug/flutter_ume_kits</p>
</aside>
<h2 is-upgraded><strong>使用插件调试应用</strong></h2>
<p>点击插件列表中的 &#34;WidgetInfo&#34; 按钮，并点选屏幕上的组件。</p>
<p class="image-container"><img style="width: 266.98px" src="img/f3042757e3c22826.png"><img style="width: 268.50px" src="img/c8b4e19754651f7d.png"></p>
<p>此时可以看到调试界面上出现了这两组 UI 对应的 Widget 所在文件及行号。</p>
<p>回到调试工具目录，选择 ShowCode。</p>
<p class="image-container"><img style="width: 278.52px" src="img/6257ffda5bb63298.png"><img style="width: 279.50px" src="img/e9df601749bde622.png"></p>
<p>在搜索框输入 <code>package:demo_app/</code>，在左侧菜单中可以找到当前运行的，本示例工程的所有代码。</p>


      </google-codelab-step>
    
      <google-codelab-step label="在 Release mode 中使用 flutter_ume" duration="10">
        <p>在前面的步骤中，我们已经成功地在 Debug mode 中接入了 flutter_ume。</p>
<p>但有时候，可能你需要将测试版本交付给产品经理、设计师、测试人员等，以用于验收应用的质量。通常来说，这种测试版本是在 release mode 下构建的，才能获得等同于真实线上用户的体验，确保测试环节的准确性。在这样的条件下，如果有像 flutter_ume 这样的调试工具就再好不过了。好消息是，flutter_ume 可以在 release mode 下使用。仅需一点点小的调整。</p>
<p>在 <code>pubspec.yaml</code> 中修改代码，将 flutter_ume 相关的所有依赖从 <code>dev_dependencies</code> 里面移动到 <code>dependencies</code> 中。</p>
<p><code>pubspec.yaml</code></p>
<pre><code>dependencies:
  flutter_ume: ^1.1.1+1
  flutter_ume_kit_ui: ^1.0.0
  flutter_ume_kit_console: ^1.0.0
  flutter_ume_kit_show_code: ^1.0.0+1
  flutter_ume_kit_perf: ^1.0.0
  flutter_ume_kit_device: ^1.0.0</code></pre>
<p>在 main 方法中，将注册插件的代码与 UMEWidget 相关代码从 kDebugMode 的分支中移除。</p>
<p><code>main.dart</code></p>
<pre><code>void main() {
  PluginManager.instance
    ..register(WidgetInfoInspector())
    ..register(WidgetDetailInspector())
    ..register(AlignRuler())
    ..register(ColorPicker())
    ..register(TouchIndicator())
    ..register(Performance())
    ..register(ShowCode())
    ..register(MemoryInfoPage())
    ..register(CpuInfoPage())
    ..register(DeviceInfoPanel())
    ..register(Console());
  runApp(const UMEWidget(
    child: MyApp(),
  ));
}</code></pre>
<p>退出应用，执行下 flutter clean，再次重新执行 flutter pub get，使用 release 模式运行工程。</p>
<aside class="special"><p><strong>提示：</strong>iOS 模拟器设备不支持 release 模式</p>
</aside>
<p class="image-container"><img style="width: 273.81px" src="img/b75558383f716068.png"><img style="width: 274.16px" src="img/f8181b506b9c318e.png"></p>
<p>在 Release 模式下，我们仍然获得了一些调试信息。（部分插件功能在 Release 模式下不可用）</p>


      </google-codelab-step>
    
      <google-codelab-step label="编写自定义插件" duration="20">
        <h2 is-upgraded><strong>创建自定义插件包</strong></h2>
<p>切换到 demo_app 的同级目录，执行 <code>flutter create -t package custom_kit</code>。</p>
<p class="image-container"><img style="width: 500.50px" src="img/5978ce16eff92354.png"></p>
<h2 is-upgraded><strong>编写自定义插件代码</strong></h2>
<p>在 custom_kit 中的 <code>pubspec.yaml</code> 中添加对 flutter_ume 的依赖。</p>
<p><code>pubspec.yaml</code></p>
<pre><code>dependency:
  flutter_ume: ^1.1.1</code></pre>
<p>打开 custom_kit 工程，编写插件内容。</p>
<p><code>custom_kit_panel.dart</code></p>
<pre><code>library custom_kit;

export &#39;src/custom_kit_panel.dart&#39;;</code></pre>
<p>新建目录 src，并创建 custom_kit_panel.dart</p>
<p><code>src/custom_kit_panel.dart</code></p>
<pre><code>class CustomKitPanel {
  
}</code></pre>
<p>flutter_ume 为调试工具提供了诸多公开 API，我们自定义的插件可以基于这些 API 构建。引入 flutter_ume 的依赖，并声明实现 Pluggable。</p>
<p><code>src/custom_kit_panel.dart</code></p>
<pre><code>import &#39;package:flutter_ume/flutter_ume.dart&#39;;

class CustomKitPanel implements Pluggable {
  
}</code></pre>
<p>此时 Android Studio 或 VSCode 会提示我们 Missing concrete implementations of ... and 1 more. 因为我们声明了 CustomKitPanel 要实现 Pluggable，但未真正有方法对这些方法签名进行实现。</p>
<p class="image-container"><img style="width: 601.70px" src="img/487b8ffba8f333ba.png"></p>
<p>可以利用 Android Studio 或 VSCode 的 Flutter 插件自动提示功能，为我们自动补全缺失的方法实现。</p>
<p class="image-container"><img style="width: 333.46px" src="img/c0f01e4c1450f031.png"></p>
<p>此时，CustomKitPanel 被补充为如下代码：</p>
<p><code>src/custom_kit_panel.dart</code></p>
<pre><code>class CustomKitPanel implements Pluggable {
  @override
  Widget? buildWidget(BuildContext? context) {
    // TODO: implement buildWidget
    throw UnimplementedError();
  }

  @override
  // TODO: implement displayName
  String get displayName =&gt; throw UnimplementedError();

  @override
  // TODO: implement iconImageProvider
  ImageProvider&lt;Object&gt; get iconImageProvider =&gt; throw UnimplementedError();

  @override
  // TODO: implement name
  String get name =&gt; throw UnimplementedError();

  @override
  void onTrigger() {
    // TODO: implement onTrigger
  }
  
}</code></pre>
<p>在代码中我们仍然能看到一些 TODO 与 throw UnimplementedError() 需要我们对其进行补充。</p>
<ul>
<li>buildWidget 方法用于返回插件的 UI 面板</li>
<li>displayName 方法用于提供插件展示出来的名字</li>
<li>iconImageProvider 方法用于提供插件在调试面板上的图标</li>
<li>name 用于作为插件的唯一标识</li>
<li>onTrigger 用于调试面板上点按插件图标后的 trigger 行为</li>
</ul>
<p><code>src/custom_kit_panel.dart</code></p>
<pre><code>import &#39;package:flutter/material.dart&#39;;
import &#39;package:flutter_ume/flutter_ume.dart&#39;;
import &#39;icon.dart&#39; as icon;

class CustomKitPanel implements Pluggable {
  @override
  Widget buildWidget(BuildContext? context) =&gt; Container(
        width: 200,
        height: 200,
        decoration: BoxDecoration(
          borderRadius: BorderRadius.circular(24.0),
          color: Theme.of(context!).backgroundColor,
        ),
        child: Center(child: Text(displayName)),
      );

  @override
  ImageProvider&lt;Object&gt; get iconImageProvider =&gt; MemoryImage(icon.iconBytes);

  @override
  String get name =&gt; &#39;CustomKit&#39;;

  @override
  String get displayName =&gt; &#39;CustomKit&#39;;

  @override
  void onTrigger() {
    debugPrint(&#39;onTrigger $displayName&#39;);
  }
}
</code></pre>
<h2 is-upgraded><strong>在 demo_app 引入 custom_kit</strong></h2>
<p>在 pubspec.yaml 中添加对 custom_kit 的声明</p>
<p><code>pubspec.yaml</code></p>
<pre><code>dependencies:
  custom_kit:
    path: ../custom_kit</code></pre>
<p>执行 flutter pub get，修改 main.dart 中的代码，引入 custom_kit</p>
<p><code>main.dart</code></p>
<pre><code>import &#39;package:custom_kit/custom_kit.dart&#39;;

void main() {
  PluginManager.instance
    ..register(CustomKitPanel());
}</code></pre>
<p class="image-container"><img style="width: 249.50px" src="img/bc4e104ca0144043.png"></p>
<p>重新运行 Demo App，点击 flutter_ume 面板中的 custom_kit 插件图标，可以看到 CustomKit 的面板已经出现在屏幕上了。</p>
<aside class="warning"><p><strong>思考：</strong>插件都能做些什么有意思的事？</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="向社区发布自定义插件" duration="10">
        <p>在完成了以上内容后，可以考虑将你编写的 custom_kit 发布到社区，与其他 flutter_ume 的用户共享这一成果。</p>
<p>发布包之前请使用 <code>flutter pub login</code> 命令登录到 pub。</p>
<p>要发布一个 Flutter/Dart 包，可以使用 <code>flutter pub publish</code> 命令。请注意，Dart 包的发布，是不可逆行为，因此请慎重。7 天内发布的包，可以被撤回，但 &#34;撤回&#34; 不等同于永久消失，而是被标记为 &#34;撤回状态&#34;。</p>
<p class="image-container"><img style="width: 601.70px" src="img/eb2ea857a1f717ed.png"></p>
<p>添加 <code>--dry-run flag</code> 的目的是用于仅验证包的合法性，而不真正发布包。一般来说用于发布前的最后检查。</p>
<p class="image-container"><img style="width: 601.70px" src="img/4b7919f9d8ca53b1.png"></p>
<p>如图若有 warning 或 error 都会有相应提示告知开发者，对其做相应整改即可。</p>


      </google-codelab-step>
    
      <google-codelab-step label="恭喜完成 codelab" duration="5">
        <p>恭喜，你已顺利完成你的 flutter_ume 应用内调试工具的体验之旅！</p>
<p>你创建了一个新工程，将 flutter_ume 接入到其中，体验了 flutter_ume 开发团队提供的调试插件，并亲自动手尝试编写了一个调试插件。这很了不起，未来希望 flutter_ume 能持续为你提供便捷的应用内调试能力，助你提升开发效率。</p>
<p>当然也欢迎你在开发过程中发现痛点，为 flutter_ume 的社区提供更加丰富强大的调试工具；或者为现有的调试工具进行改进，修复问题。</p>
<ul>
<li>由 flutter_ume 开发团队维护的调试工具请见 https://github.com/bytedance/flutter_ume</li>
<li>更多来自社区的调试插件解决方案请见 https://github.com/cfug/flutter_ume_kits</li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://static.codelabs.cn/codelab-elements/native-shim.js"></script>
  <script src="https://static.codelabs.cn/codelab-elements/custom-elements.min.js"></script>
  <script src="https://static.codelabs.cn/codelab-elements/prettify.js"></script>
  <script src="https://static.codelabs.cn/codelab-elements/codelab-elements.js"></script>

</body>
</html>
